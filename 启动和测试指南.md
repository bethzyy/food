# 养生饮食推荐应用 - 启动和测试指南

## 快速启动

### 方法1: 使用run.bat (最简单)

1. **双击运行** `run.bat`
2. 等待浏览器自动打开 http://localhost:8000
3. 如果浏览器没自动打开,手动访问: http://localhost:8000

### 方法2: 手动启动

1. 打开命令行(CMD或PowerShell)
2. 进入应用目录:
   ```bash
   cd C:\D\CAIE_tool\MyAIProduct\food
   ```
3. 启动服务器:
   ```bash
   python app_server.py
   ```
4. 打开浏览器访问: http://localhost:8000

---

## 测试步骤

### 1. API测试 (验证API Key和Prompt)

**运行Python测试脚本:**
```bash
cd C:\D\CAIE_tool\MyAIProduct\food
python test_glm_api.py
```

**预期结果:**
- ✅ 所有检查项通过
- ✅ API调用成功
- ✅ JSON解析成功
- ✅ 生成完整的推荐结果

### 2. 浏览器测试 (测试完整功能)

**步骤:**
1. 启动应用(运行run.bat)
2. 浏览器自动打开
3. 填写或确认以下信息:
   - 日期和时间(自动填充)
   - 餐次(早餐/午餐/晚餐)
   - 饮食类型(日常/药膳)
   - 天气选择
4. 点击"✨ 生成饮食推荐"按钮
5. 等待结果显示(10-30秒)

**查看调试信息:**
- 按F12打开开发者工具
- 切换到Console(控制台)标签
- 查看详细的执行日志

---

## 常见问题

### Q1: 点击按钮没反应

**解决方法:**
1. 按F12打开开发者工具
2. 查看Console标签
3. 查看是否有错误信息
4. 刷新页面重试

### Q2: 提示"未找到API Key"

**解决方法:**
```bash
# Windows PowerShell
$env:ZHIPU_API_KEY="your-api-key-here"

# 然后在同一窗口运行
python app_server.py
```

### Q3: AI返回内容解析失败

**可能原因:**
- AI返回了非JSON格式的内容
- prompt太长导致模型截断

**解决方法:**
1. 打开浏览器控制台(F12)
2. 查看完整的AI返回内容
3. 如果内容被截断,尝试减小max_tokens参数
4. 如果格式错误,检查prompt是否正确要求JSON格式

### Q4: 端口8000被占用

**解决方法:**
```bash
# 查找占用端口的进程
netstat -ano | findstr :8000

# 结束进程(替换PID)
taskkill /F /PID 45088
```

---

## 测试工具

### Python测试脚本

1. **test_glm_api.py** - 完整的API测试
   ```bash
   python test_glm_api.py
   ```

2. **test_glm47_api.py** - GLM-4.7专项测试
   ```bash
   python test_glm47_api.py
   ```

### 浏览器测试页面

1. **test_api.html** - 浏览器API测试
   - 访问: http://localhost:8000/test_api.html
   - 点击"测试API调用"按钮
   - 查看测试结果

---

## 当前配置

### API配置
- **模型**: glm-4.7
- **温度**: 0.7
- **最大tokens**: 3000
- **API端点**: https://open.bigmodel.cn/api/paas/v4/chat/completions

### Prompt文件
- **位置**: prompts/food_recommendation_prompt.txt
- **风格**: 雅致中国风
- **特点**: 引用《黄帝内经》等中医经典

### JSON输出结构
```json
{
  "dishes": [...],           // 菜品数组
  "totalNutrition": {...},    // 总体营养
  "reasoning": {...},         // 推荐理由(含中医理论)
  "tips": {...}              // 温馨提示
}
```

---

## 调试技巧

### 1. 查看API返回内容

在浏览器控制台中,查找:
```
返回内容预览: ...
```

### 2. 查看解析状态

查找:
```
✅ JSON解析成功
❌ JSON解析失败
```

### 3. 查看错误信息

如果有错误,控制台会显示:
```
❌ 生成推荐失败: [错误信息]
```

---

## 测试检查清单

使用前请确认:

- [ ] API Key已设置(环境变量或浏览器输入)
- [ ] 服务器正在运行(访问http://localhost:8000能看到页面)
- [ ] Python测试脚本运行通过
- [ ] 浏览器控制台无JavaScript错误
- [ ] 点击按钮后有响应(显示加载动画)

---

## 联系支持

如果遇到问题:

1. 查看 `测试报告.md` - 详细的测试结果
2. 查看 `最终说明.md` - 完整的功能说明
3. 查看 `使用说明.md` - 使用指南
4. 运行 `test_glm_api.py` - 验证API配置

---

**祝您使用愉快!** 🍲🥗🍜
