# 🎉 养生饮食推荐应用 - 最终版

## ⚡ 超级简单启动

**双击运行：`run.bat`**

---

## 🎯 应用特点

### 智能推荐
- ✅ 自动识别24节气
- ✅ 中医养生理论 + 现代营养学
- ✅ 荤素搭配、干湿结合
- ✅ 详细制作步骤

### 自动获取
- ✅ 日期时间（可修改）
- ✅ 地理位置（可手动）
- ✅ 天气信息（8种天气）

### 中国风设计
- ✅ 四季动态主题
- ✅ 雅致护眼配色
- ✅ 紧凑清晰布局

### 环境信息整合
所有信息都在一个板块：
- 📅 时间与节气（日期、时间、节气显示）
- 📍 位置与天气（城市、天气选择）

---

## 🚀 使用流程

1. **启动应用**
   ```
   双击 run.bat
   ```

2. **浏览器自动打开**
   http://localhost:8000

3. **选择设置**
   - 时间节气（自动显示）
   - 位置天气（自动获取）
   - 餐次（早/中/晚）
   - 类型（日常/药膳）

4. **生成推荐**
   ```
   点击 "✨ 生成饮食推荐" 按钮
   ```

5. **查看结果**
   - 专业菜品推荐
   - 营养分析图表
   - 制作方法详述

---

## 🔑 API Key

### 设置环境变量（推荐）
```bash
# Windows PowerShell
$env:ZHIPU_API_KEY="你的API Key"

# 然后双击 run.bat
```

### 浏览器输入（无需设置）
直接运行 `run.bat`，首次使用会提示输入（自动保存）

---

## 📁 核心文件

| 文件 | 说明 |
|------|------|
| `run.bat` | **一键启动** ⭐ |
| `app_server.py` | 统一服务器 |
| `index.html` | 主页面 |
| `app.js` | 主程序 |
| `style.css` | 样式 |
| `prompts/*.txt` | AI提示词 |

---

## 🎨 四季主题

- 🌱 **春季**（3-5月）：竹青色
- 🌊 **夏季**（6-8月）：天蓝色
- 🍂 **秋季**（9-11月）：金橙色
- ❄️ **冬季**（12-2月）：烟灰色

---

## ⚠️ 常见问题

### Q: 设置了环境变量还是提示输入？
**A**: 在同一命令行窗口设置并启动：
```bash
$env:ZHIPU_API_KEY="your-key"
python app_server.py
```

### Q: AI返回格式错误？
**A**: 已修复！增强了容错性：
- 多种JSON提取方法
- 文本提取备用方案
- 详细的错误日志

### Q: 浏览器没自动打开？
**A**: 手动访问 http://localhost:8000

---

## 📊 技术亮点

### 统一服务器
- 智能检测环境变量
- 自动提供API端点
- 端口复用支持

### 增强解析
- 多层JSON提取
- 文本备用解析
- 详细调试日志

### 代码优化
- 修复async/await
- 移除重复元素
- 简化启动流程

---

## 📝 更新日志

### v2.0（最终版）
- ✅ 统一服务器
- ✅ 增强JSON解析
- ✅ 环境信息整合
- ✅ 简化启动流程
- ✅ 修复所有已知问题

---

## 🎓 获取API Key

1. 访问：https://open.bigmodel.cn/
2. 注册并登录
3. 进入控制台
4. 获取API Key

---

**享受健康饮食！** 🍲🥗🍜

---

## 📧 技术支持

- **使用说明**: 查看本文件
- **故障排查**: 查看 `故障排查.md`
- **测试工具**: `python test_env_key.py`
