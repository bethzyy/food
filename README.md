# 养生饮食推荐应用 🥗

基于中医养生理论与现代营养学的智能饮食推荐系统，由GLM-4.7大模型驱动。

## 📋 功能特点

### 1. 智能时间管理
- ✅ 自动获取当前日期和时间
- ✅ 根据时间智能判断早中晚（5-9点早餐，11-14点午餐，17-20点晚餐）
- ✅ 支持手动修改日期和时间

### 2. 地理位置与天气
- ✅ 自动获取地理位置（需浏览器授权）
- ✅ 集成Open-Meteo免费天气API
- ✅ 支持8种天气类型：晴、多云、阴、雨、雪、雾、大风、沙尘
- ✅ 支持手动选择天气

### 3. 节气与季节智能识别
- ✅ 内置24节气数据库（精确到日）
- ✅ 自动识别春、夏、秋、冬四季
- ✅ 动态背景主题切换（春绿、夏蓝、秋橙、冬白）
- ✅ 本地中国风插画支持（41个PNG文件，24节气+传统节日）
- ✅ 70%雾化效果，确保文字清晰可读
- ✅ 玻璃态拟态设计，现代美观
- ✅ 结合中医"四时五补"理论

### 4. 饮食类型选择
- ✅ **日常饮食**: 注重食材本身的营养价值和烹饪方式
- ✅ **药膳饮食**: 融入中药材或药食同源食材，说明性味归经

### 5. 专业推荐内容
- ✅ 4-6道详细菜品（包括主食、热菜、汤品）
- ✅ 每道菜包含：
  - 富有诗意的菜名
  - 精确到克的食材用量
  - 中医性味归经说明
  - 现代营养价值
  - 5-8个详细制作步骤
  - 热量和营养素含量
  - 适宜人群说明
- ✅ 专业建议：食材选购、烹饪要点、搭配建议、禁忌提醒

### 6. 营养分析
- ✅ 精确计算总热量（大卡）
- ✅ 三大营养素含量及占比（蛋白质、脂肪、碳水化合物）
- ✅ 详细维生素和矿物质含量
- ✅ 200字左右的营养特点综合分析
- ✅ 交互式饼图展示营养比例

### 7. 日志记录系统
- ✅ 记录每次API调用的完整信息：
  - 请求元数据（模型、参数、tokens）
  - 完整提示词
  - 模型输出内容
  - 响应时间
  - 错误信息
- ✅ 日志存储在浏览器localStorage（最多保留100条）
- ✅ 支持导出日志为JSON文件

## 🚀 快速开始

### 方法一：直接打开（推荐用于测试）

1. 双击 `index.html` 文件在浏览器中打开
2. 首次使用需要输入API Key（会保存在浏览器中）

### 方法二：本地HTTP服务器（推荐用于开发）

由于使用了fetch API加载提示词文件，建议通过HTTP服务器运行：

```bash
# 使用Python 3
python -m http.server 8000

# 或使用Python 2
python -m SimpleHTTPServer 8000

# 或使用Node.js的http-server
npx http-server -p 8000
```

然后在浏览器访问：`http://localhost:8000`

### 方法三：部署到服务器

将整个文件夹部署到任何支持静态网站的服务器：
- Nginx
- Apache
- GitHub Pages
- Vercel
- Netlify

## 🔑 API Key配置

### 获取API Key

1. 访问智谱AI开放平台：https://open.bigmodel.cn/
2. 注册并登录账号
3. 在控制台获取API Key

### 配置方式

**方式1：环境变量（推荐）**
在系统环境变量中设置 `ZHIPU_API_KEY`：
```bash
# Windows PowerShell
$env:ZHIPU_API_KEY="your-api-key-here"

# Windows CMD
set ZHIPU_API_KEY=your-api-key-here

# Linux/Mac
export ZHIPU_API_KEY="your-api-key-here"
```

**方式2：浏览器输入（简单）**
首次运行时会弹出输入框，输入后保存在浏览器localStorage中。

## 📁 项目结构

```
food/
├── index.html                      # 主HTML文件
├── style.css                       # 样式文件（~1700行，玻璃态设计）
├── app.js                          # 主程序逻辑（~1800行）
├── prompts/                        # 提示词文件夹
│   ├── food_recommendation_prompt.txt  # 主提示词模板（42行）
│   └── tea_recommendation_prompt.txt   # 茶饮推荐提示词
├── images/
│   └── festival_art/               # 中国风插画（41个PNG文件）
│       ├── 立春.png
│       ├── 雨水.png
│       └── ... (24节气 + 传统节日)
├── server_with_env.py              # Python服务器（支持环境变量）
├── illustration_download_guide.html # 插画下载指南
└── README.md                      # 使用说明
```

## 🎨 技术栈

- **前端框架**: 纯HTML/CSS/JavaScript（无框架）
- **图表库**: Chart.js 4.4.0
- **AI模型**: GLM-4-flash → GLM-4.6 → GLM-4.7（智谱AI，自动降级）
- **天气API**: Open-Meteo（免费，无需API Key）
- **地理定位**: 浏览器Geolocation API
- **视觉设计**: 玻璃态拟态设计（Glassmorphism），backdrop-filter模糊效果
- **背景系统**: 本地PNG插画优先，自动降级到CSS渐变，70%白色雾化遮罩

## 🔧 配置说明

### 修改提示词

编辑 `prompts/food_recommendation_prompt.txt` 文件，使用以下占位符：

- `{date}`: 日期
- `{time}`: 时间
- `{mealPeriod}`: 餐次（早餐/午餐/晚餐）
- `{dietType}`: 饮食类型（日常饮食/药膳饮食）
- `{weather}`: 天气
- `{solarTerm}`: 节气
- `{season}`: 季节

### 自定义主题颜色

编辑 `style.css` 文件中的 `:root` 变量：

```css
:root {
    --spring-primary: #7cb342;    /* 春季主色 */
    --summer-primary: #42a5f5;    /* 夏季主色 */
    --autumn-primary: #ff9800;    /* 秋季主色 */
    --winter-primary: #90a4ae;    /* 冬季主色 */
}
```

### 调整背景雾化效果

编辑 `style.css` 文件中的 `.app-container::before` 样式：

```css
.app-container::before {
    background: rgba(255, 255, 255, 0.7);  /* 调整透明度 (0.5-0.9) */
}
```

## 🎨 视觉设计

### 玻璃态拟态设计（Glassmorphism）

应用采用现代玻璃态设计风格，所有UI组件都使用半透明背景和模糊效果：

- **主容器**: 85%透明白色 + 10px模糊
- **菜品卡片**: 70%透明白色 + 8px模糊
- **输入框**: 80%透明白色，聚焦时95%
- **按钮**: 主按钮（绿色）+ 模糊效果，次按钮（75%透明白色）+ 模糊
- **单选按钮**: 75%透明白色 + 8px模糊
- **信息卡片**: 75%透明白色 + 8px模糊

### 背景系统

1. **本地插画优先** - 优先加载 `images/festival_art/` 中的PNG文件
2. **自动降级** - 如果本地图片不存在，自动使用CSS渐变背景
3. **雾化遮罩** - 70%白色半透明层，确保文字清晰可读
4. **24节气背景** - 每个节气都有独特的中国风渐变色彩
5. **传统节日背景** - 13个传统节日专属渐变色彩

### 颜色系统

- **春季**: 绿色系 (#7cb342) - 生机勃勃
- **夏季**: 蓝色系 (#42a5f5) - 清爽宜人
- **秋季**: 橙色系 (#ff9800) - 丰收温暖
- **冬季**: 灰蓝色系 (#90a4ae) - 宁静沉稳

## 🧪 测试

打开 `index.html` 进行功能测试：

1. **API Key测试**: 验证API Key配置
2. **节气判断测试**: 测试不同日期的节气识别
3. **季节主题测试**: 测试四季主题切换
4. **提示词加载测试**: 验证提示词文件读取
5. **日志记录测试**: 测试日志功能
6. **完整推荐流程测试**: 测试完整的API调用
7. **数据格式兼容性测试**: 测试新旧JSON格式

## 📊 日志系统

### 查看日志

1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 输入：`app.logger.getLogs()`

### 导出日志

1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 输入：`app.logger.exportLog()`

### 清空日志

1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 输入：`app.logger.clearLog()`

## 🌟 特色功能

### 1. 中医理论深度结合

- **四时五补**: 春季升补、夏季清补、秋季平补、冬季温补
- **五色入五脏**: 青（肝）、赤（心）、黄（脾）、白（肺）、黑（肾）
- **性味调和**: 寒热温凉平衡，不过偏
- **因时制宜**: 根据节气特点调整饮食

### 2. 现代营养学精准分析

- 精确计算每道菜的热量和营养素
- 三大营养素比例分析
- 微量元素（维生素、矿物质）含量
- 营养协同作用考虑

### 3. 荤素搭配、干湿结合

- **荤素搭配**: 肉类提供优质蛋白，蔬菜提供维生素和膳食纤维
- **干湿搭配**: 既有主食菜肴，也有汤羹粥品
- **营养均衡**: 优质蛋白质、必需脂肪酸、复合碳水化合物

### 4. 天气适配

- **晴**: 注重清热润燥
- **雨**: 考虑祛湿健脾
- **雪**: 强调温补御寒
- **雾**: 注意润肺养阴

## 💡 使用建议

### 早餐（5-9点）
- 宜温补养胃
- 选择易消化的温热食物
- 如：粥品、温牛奶、鸡蛋

### 午餐（11-14点）
- 宜营养均衡
- 荤素搭配，能量充足
- 如：米饭+肉类+蔬菜+汤

### 晚餐（17-20点）
- 宜清淡易消化
- 避免过于油腻
- 如：清淡蔬菜、少量主食、易消化的汤品

## ⚠️ 注意事项

1. **API Key安全**:
   - 不要将API Key硬编码在代码中
   - 不要将API Key提交到版本控制系统
   - 使用环境变量或浏览器localStorage存储

2. **浏览器兼容性**:
   - 推荐使用Chrome、Edge、Firefox最新版本
   - 需要支持ES6+语法
   - 需要支持Geolocation API

3. **网络要求**:
   - 需要能够访问 `open.bigmodel.cn`
   - 需要能够访问 `open-meteo.com`（天气API）
   - 建议使用HTTP服务器运行（而非file://协议）

4. **数据存储**:
   - API Key存储在localStorage中（清除浏览器数据会丢失）
   - 日志最多保留100条（自动循环覆盖）
   - 推荐数据不会持久化（刷新页面会重置）

## 🐛 常见问题

### Q: 提示"未找到API Key"
A: 请检查是否设置了环境变量 `ZHIPU_API_KEY`，或在浏览器中输入API Key。

### Q: 提示词加载失败
A: 请使用HTTP服务器运行（而非直接打开HTML文件），或检查 `prompts/food_recommendation_prompt.txt` 文件是否存在。

### Q: 地理位置获取失败
A: 请检查浏览器定位权限设置，或手动选择天气。

### Q: 天气API获取失败
A: Open-Meteo API可能暂时不可用，不影响主要功能，可以手动选择天气。

### Q: 营养图表不显示
A: 检查网络连接，Chart.js需要从CDN加载（https://cdn.jsdelivr.net）。

## 📝 开发计划

- [ ] 添加历史记录功能（保存用户的推荐历史）
- [ ] 支持多语言（英文、日文等）
- [ ] 添加食材购物清单生成
- [ ] 支持自定义饮食偏好（素食、过敏源等）
- [ ] 添加分享功能（生成分享链接）
- [ ] 开发移动端App版本

## 📄 许可证

本项目仅供学习和个人使用。

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📧 联系方式

如有问题或建议，请提交Issue。

---

**享受健康饮食，从四季养生开始！** 🍲🥗🍜
